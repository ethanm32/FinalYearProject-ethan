@model WebApplication4.Models.ClickModel
@Html.HiddenFor(m => m.HtmlSong, new { id = "song" })

@{
    ViewBag.Title = "Search";
    Layout = "~/Views/Shared/_Layout.cshtml";



}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<body>
    <h2>Search</h2>
    <div id="search-div">
        <input type="search" id="search-value" placeholder="Search a song or album "/>
        <input type="button" value="Search" onclick="Search()" id="searchButton" />
    </div>
           
    


    <div id="container"></div>


</body>

<script>
    

        var accessToken = null;
        window.onload = function getApiAccess() {
            const CLIENT_ID = '13825d1ddbcb4eb98c5265c4f453510e';
            const CLIENT_SECRET = '8e98f1bda24f4581acfeaed2b4bac525';
            var authParams = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'grant_type=client_credentials&client_id=' + CLIENT_ID + '&client_secret=' + CLIENT_SECRET
            }

            fetch('https://accounts.spotify.com/api/token', authParams)
                .then(response => response.json())
                .then(data => accessToken = data.access_token)
                .then(() => console.log(accessToken))
    }

    async function Search() {
        var input = document.getElementById("search-value").value;
        document.getElementById("search-div").style = "margin: 0 auto;text - align: center;position: relative;top: 25px; left: 25px;";
        //document.getElementById("searchButton").style = "display: none";
       var trackParams = {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + accessToken
            }
        }
        var returnedTracks = fetch('https://api.spotify.com/v1/search?q=' + input + "&type=track", trackParams)
            .then(response => response.json())
            .then(data => {
                console.log(data);
                console.log(data.tracks.items.length)

                addData(data);

            });

        var returnedAlbums = fetch('https://api.spotify.com/v1/search?q=' + input + "&type=album", trackParams)
            .then(response => response.json())
            .then(data => {
                console.log(data);
                console.log(data.albums.items.length);

                addAlbum(data);

            });

        $('#search-value').on('focus', function () {
            document.getElementById("container").innerHTML = "";
        });

        function addData(data) {

            var returned = data.tracks.items;
            var container = document.getElementById("container");
            for (let i = 0; i < returned.length; i++) {
                var div = document.createElement("div");
                var img = document.createElement("img");
                var p = document.createElement("p");
                console.log(data);
                img.src = returned[i].album.images[1].url;

                div.style.color = "white";
                div.id = "textDiv";
                div.appendChild(img);
                p.innerHTML += 'Name:' + returned[i].name + '<br>' + 'Artist:' + returned[i].artists[0].name;
                div.appendChild(p);
                container.appendChild(div);



                div.onclick = function () {
                    var value = this.innerHTML;
                    localStorage.setItem("storageName", value);
                    window.open('@Url.Action("Song", "User")');
                }
            }

        }

        function addAlbum(data) {

            var returned = data.albums.items;
            var container = document.getElementById("container");
            for (let i = 0; i < returned.length; i++) {
                var div = document.createElement("div");
                var img = document.createElement("img");
                var p = document.createElement("p");
                console.log(data);
                img.src = returned[i].images[1].url;
                div.style.color = "white";
                div.id = "albumText";
                div.appendChild(img);
                p.innerHTML += 'Name:' + returned[i].name + '<br>' + 'Artist:' + returned[i].artists[0].name;
                div.appendChild(p);
                container.appendChild(div);


                div.onclick = function () {
                    var value = this.innerHTML;
                    var id = returned[i].id
                    localStorage.setItem("AlbumId", id);
                    localStorage.setItem("albumName", value);
                    
                    window.open('@Url.Action("Album", "User")');
                }
            }
        }





    }
</script>
<style>

    
    
    
    #container { 
        display: grid;
        grid-template-columns: 2fr 2fr 2fr;
        grid-gap: 10px;
        position: relative;
        top: 200px;
        left: 2.5em;
    }

    #textDiv {
        display: none;
        text-align: justify;
        width: 180px;
    }

        #textDiv img {
            display: none;
            display: block;
            margin: 0 auto;
        }


    #albumText {
        text-align: justify;
        width: 180px;
    }

        #albumText img {
            display: block;
            margin: 0 auto;
        }

   #search-div {
       margin: 0 auto;
       text-align: center;
       position: relative;
       top: 250px;
   }

   #search-value {
       width: 400px;
       height: 50px;
       border-radius: 10px;
   }


   #searchButton {
       height: 50px;
   }


</style>
