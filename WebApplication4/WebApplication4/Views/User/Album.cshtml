
@{
    ViewBag.Title = "Album";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Album</h2>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<h2></h2>
<div id="album-container">

</div>
<br />
<br />
<div  class="rating">
    <div id="rating" class="text-center">

        My Rating
        </br>
        <i class="rating_stars fa fa-star"></i>
        <i class="rating_stars fa fa-star"></i>
        <i class="rating_stars fa fa-star"></i>
        <i class="rating_stars fa fa-star"></i>
        <i class="rating_stars fa fa-star"></i>
    </div>
</div>
<div id="tracks-container" class="text-center"></div>
<button onclick="Album()">Show tracks</button>



<script>
    var id = localStorage.getItem("AlbumId");
    var accessToken = null;
    window.onload = function getApiAccess() {
        const CLIENT_ID = '13825d1ddbcb4eb98c5265c4f453510e';
        const CLIENT_SECRET = '8e98f1bda24f4581acfeaed2b4bac525';
        var authParams = {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'grant_type=client_credentials&client_id=' + CLIENT_ID + '&client_secret=' + CLIENT_SECRET
        }


        fetch('https://accounts.spotify.com/api/token', authParams)
            .then(response => response.json())
            .then(data => accessToken = data.access_token)
            .then(() => console.log(accessToken))
    }

    var album = localStorage.getItem("albumName");
    var img = document.createElement("img");
    var newAlbum = document.getElementById('album-container');
    newAlbum.style.padding = "0px";
    var p = document.createElement("p");
    p.setAttribute("id", "newP");
    console.log("a" + album);

    img.src = album.substring(album.indexOf("c=") + 3, album.lastIndexOf('"><p'));
    img.setAttribute('class', 'img-responsive center-block img-rounded');

    newAlbum.appendChild(img);
    var albumName1 = album.substring(album.indexOf("e:") + 2, album.lastIndexOf("<b"));
    var rating = document.getElementById("rating");
    console.log(albumName1);
    p.innerHTML += albumName1;
    newAlbum.appendChild(p);
   
    if (albumName1.length > 20) {
        document.getElementById("newP").style.fontSize = '1vw';
    }
    if (albumName1.length >= 30) {
        document.getElementById("newP").style.right = '20vw';

    }

    var InnerAlbum = newAlbum.innerHTML;
    const afterp = InnerAlbum.substring(InnerAlbum.indexOf('<p'));
    console.log("p" + afterp);
    p.style.float = "right"
    var rating = document.getElementById("rating");

    function Album() {
        var trackParams = {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + accessToken
            }
        }

        var returnedTracks = fetch('https://api.spotify.com/v1/albums/' + id, trackParams)
            .then(response => response.json())
            .then(data => {
                console.log(data);
                console.log(data.tracks.items);



                addAlbum(data);
            });


    }

    function addAlbum(data) {

        var returned = data.tracks.items;
        var container = document.getElementById("tracks-container");
        for (let i = 0; i < returned.length; i++) {
            var div = document.createElement("div");
            var p = document.createElement("p");
            console.log(data);
            div.style.color = "white";
            div.id = "albumText";
            const duration = new Date(returned[i].duration_ms)
            p.innerHTML += 'Name:' + returned[i].name + '<br>' + 'Length:' + duration.getMinutes() + ':' + duration.getSeconds();
            container.appendChild(p);
        }
    }


    $('.rating').on('click', '.rating_stars', function () {
        var star = $(this).index();
        $('.rating_stars').each(function (index) {
            return index >= star - 1 ? $(this).addClass('selected') :
                $(this).removeClass('selected');
        });

    });
    let counter = 0;
    function createNote() {
        counter++;
        var addBtn = document.getElementById("add");
        addBtn.style.display = 'none';
        var divnote = document.createElement('div');
        var text = document.getElementById("text-note").value;
        divnote.innerHTML += text;
        divnote.setAttribute("id", "div" + counter);
        var review = document.getElementById("review");
        review.appendChild(divnote);
        var deleteBtn = document.createElement('button');
        deleteBtn.setAttribute("id", "div" + counter);
        deleteBtn.innerHTML = "Delete";
        var editBtn = document.createElement('button');
        editBtn.innerHTML = "Edit";
        editBtn.setAttribute("id", "div" + counter);
        review.appendChild(deleteBtn);
        divnote.style.width = "fit-content";
        review.appendChild(editBtn);
        divnote.style.whiteSpace = "pre-wrap";
        divnote.style.wordWrap = "word-break";




        divnote.style.border = "1px solid black";
        divnote.style.borderRadius = "5px";

        deleteBtn.onclick = function () {
            var id = event.srcElement.id;
            document.getElementById(id).innerHTML = "";
            deleteBtn.remove();
            editBtn.remove();
            addBtn.style.display = 'inline-block';

        };

        editBtn.onclick = function () {
            var id = event.srcElement.id;
            document.getElementById(id).contentEditable = "true";
            var saveBtn = document.createElement('button');
            saveBtn.innerHTML = "Save Changes";
            saveBtn.setAttribute("id", id);

            review.appendChild(saveBtn);

            saveBtn.onclick = function () {
                var saveId = event.srcElement.id;
                console.log(counter);
                document.getElementById(saveId).contentEditable = "false";
                saveBtn.remove();
            }
        }

        return divnote.id;
    }






</script>
<style>

    div {
        color: white;
    }

    .checked {
        color: orange;
    }

    .rating_stars.selected {
        color: orange;
    }

    i {
        display: inline-block;
    }

    .rating {
        text-align: left;
        direction: rtl;
    }

    i:hover ~ i,
    i:hover {
        color: orange;
    }

    #review {
        position: absolute;
        left: 50%;
        top: 100px;
    }

    #h2 {
        color: white;
    }

    textarea {
        color: black;
    }

    button {
        background-color: darkgoldenrod;
        margin-bottom: 60px;
    }

    img {
        position: relative;
        right: 10em;
    }

    #newP {
        position: absolute;
        top:100px;
        right:30vw;
        font-size: 2vw;
    }

    #text-container {
        position: absolute;
        right: 20em;
    }
</style>


